# Thunderbird Addon UI 稳定性与决策规则设计（2026-02-25）

## 1. 背景

当前插件核心功能已可用，但在识别流程、折叠状态、滚动定位、固定底栏、动作一致性等方面仍存在可感知的交互问题。

本设计采用两阶段：

- 第一阶段：稳定交互优先（先修 UI/状态一致性）
- 第二阶段：分类精度优化（重点处理“标记已读/转为待办”）

## 2. 范围拆分

### 2.1 第一阶段（本次）

覆盖用户提出问题中的：

1) LLM识别和添加过程中，分组与事件保持折叠
2) 配置页每个配置项补充小灰字简短说明
3) 窗口最小化后恢复时保留原滚动位置与展开状态
4) “已添加日历”默认完全折叠（不显示明细）
5) StatusBox + 版本号固定在窗口底部，始终可见
6) 事件处理后自动折叠回仅标题
7) 顶部增加“全部展开/收起”按钮
8) 状态栏实时显示“已处理 N 个事项”
9) 点击“导入日历”后自动滚动并聚焦日历选择区
11) 点击“确认/拒绝/标记已读/转为待办”时先自动打开对应邮件
12) “已添加日历”记录提供“查看原邮件”跳转入口

### 2.2 第二阶段（后续）

10) “标记已读/转为待办”更精确区分策略迭代（本次先落地保守v1）

## 3. 第一阶段详细设计

### 3.1 折叠状态与识别流程

新增统一状态管理：

- `globalExpandAll`：全局展开/收起状态
- `groupExpandedAllByKey`：分组展开状态
- `expandedItemsByGroup`：事件级展开状态

规则：

- “刷新/扫描未读/右键识别”开始时，统一重置为折叠状态。
- 识别期间新增结果时，不自动展开。
- 用户手动展开单个事件仍可查看详情；双击编辑保持不变。
- 事件处理动作成功后，强制该事件回到折叠状态（只显示标题）。

### 3.2 “已添加日历”分组

- 默认完全折叠（仅显示分组头与数量）。
- 默认不渲染明细项，点击组名后渲染并展开。
- 仍保持位于最底部。

### 3.3 固定底栏与滚动容器

布局改造：

- 主容器使用 `display:flex; flex-direction:column; height:100vh;`
- 列表区域作为独立滚动容器
- 底部 `status/version` 固定在窗口底部（不随列表滚动）

Status 文案新增处理进度统计：

- `已处理 N 个事项`（按确认/拒绝/标记已读/转为待办累计）
- 与扫描/导入状态共存，采用单行优先显示策略

### 3.4 导入日历交互

- 点击“导入日历”且出现选择器时，自动 `scrollIntoView` 到选择器区域。
- 自动聚焦第一个可选日历项。

### 3.5 卡片动作与邮件联动

对以下动作统一先执行“打开对应邮件正文”：

- 确认
- 拒绝
- 标记已读
- 转为待办

打开成功后再发动作指令；若打开失败，状态栏显示失败但仍允许继续动作（可配置为严格模式，默认非严格）。

### 3.6 已导入记录回跳

在“已添加日历”事件卡片中新增按钮：

- 中文：`查看原邮件`
- 英文：`Open Source Email`

依赖 `sourceMessageId` 执行邮件跳转。

## 4. 配置页说明文案策略

### 4.1 视觉样式

- 每项控件下方补 `helper text`
- 字号：11-12px
- 颜色：低对比灰
- 单行优先，必要时最多两行

### 4.2 文案规则

- 解释“影响结果”而非实现细节
- 避免术语堆砌
- 中英双语词库本地维护，跟随 UI 语言切换

## 5. 第10点保守策略 v1（本次同步落地）

分类原则（先规则化、可解释）：

- 优先“转为待办”条件（任一成立）：
  1) 有明确时间/截止
  2) 有明确地点或会议链接
  3) 有明确行动动词 + 行动对象
- 其余提醒型、宣传型、泛通知、感谢型信息优先“标记已读”
- no-reply/自动通知默认不建议转待办，除非命中明确截止或行动

UI策略：

- 两个按钮都保留
- 推荐动作做主按钮高亮（降低误操作成本）

## 6. 风险与回退

风险：

- 折叠状态重置可能与用户当前阅读行为冲突
- 固定底栏布局可能引入小屏遮挡
- 自动打开邮件可能导致焦点频繁切换

回退策略：

- 关键改动均可通过单独开关回退到旧行为
- 保留原有动作 API，不改数据结构主干

## 7. 验收清单（第一阶段）

- 识别过程中不自动展开分组与事件
- “全部展开/收起”有效且与分组按钮不冲突
- 事件处理后自动折叠
- 已添加日历默认完全折叠
- 状态栏与版本号固定底部始终可见
- 状态栏实时显示已处理数量
- 导入日历可自动滚动到选择器
- 动作按钮可自动打开对应邮件
- 已导入记录可回跳邮件正文
- 配置页每项均有说明文案

## 8. 后续（第二阶段）

- 引入更细粒度判定器（规则 + LLM置信度）
- 支持用户对分类结果反馈并反哺规则
- 增加分类诊断信息（为什么推荐某个按钮）
