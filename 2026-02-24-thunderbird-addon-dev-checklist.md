# Thunderbird Todo Sidebar 开发执行清单（开发版）

日期：2026-02-24  
适用版本：`0.5.6+`  
用途：开发逐项执行、联调、回归验证

---

## 1. 环境与打包

- [ ] 确认目录：`thunderbird-addon/`、`scripts/build_thunderbird_xpi.sh` 存在。  
- [ ] 修改代码后先运行：
  - `node --check thunderbird-addon/background.js`
  - `node --check thunderbird-addon/sidebar/panel.js`
  - `node --check thunderbird-addon/options/options.js`
- [ ] 升版本号：`thunderbird-addon/manifest.json`。  
- [ ] 打包：`./scripts/build_thunderbird_xpi.sh`。  
- [ ] 确认产物：`dist/email2calendar-thunderbird-<version>.xpi`。  
- [ ] UI 内显示版本号，避免误装旧包。

---

## 2. 入口与窗口

- [ ] 顶部 `Todo Sidebar` 点击能打开窗口。  
- [ ] 邮件内 `Todo Sidebar` 点击能打开同等能力窗口。  
- [ ] 打开后无白屏。  
- [ ] 重复开关不报错。  
- [ ] 状态栏可显示动作结果和错误。

---

## 3. LLM 设置链路

- [ ] `LLM` 按钮能打开设置页。  
- [ ] `Base URL / Model / API Key` 可输入。  
- [ ] `Save` 能保存到 `storage.local`。  
- [ ] 关闭再打开值仍在。  
- [ ] 保存失败有明确错误文案。  
- [ ] 未配置 LLM 时本地规则仍可工作。

---

## 4. 扫描链路

- [ ] `Scan Unread` 点击有即时反馈（running 状态）。  
- [ ] 扫描进度可见（总数/已处理/百分比）。  
- [ ] 扫描结束显示摘要（scanned/extracted）。  
- [ ] 若账户选择控件不可用，能降级到稳定路径。  
- [ ] 扫描失败提示包含原因。

---

## 5. 候选与分组

- [ ] 候选仅显示标题/时间/地点三层信息（不默认显示摘要）。  
- [ ] 分组由 LLM 动态决定（组名可变），若存在“可能重要的事”则固定第一。  
- [ ] 每组显示数量。  
- [ ] 无数据时显示空态，不报错。  
- [ ] 重复事项有可识别标记（如 `[重复xN]`），并可展开关联邮件列表。

---

## 6. 卡片交互

- [ ] 单击：选中 + 跳转源邮件 + 正文显示对应邮件。  
- [ ] 双击：仅 `todo` 进入编辑态；未双击时不显示编辑输入框。  
- [ ] 编辑保存生效并刷新。  
- [ ] `todo` 支持：确认、拒绝、恢复。  
- [ ] 确认后从原分组移除并进入“已接受事件”分组（默认折叠，固定最末）。  
- [ ] 拒绝后在原分组原位置灰显保留，并可恢复。  
- [ ] `important` 支持：标记已读、转为待办。  
- [ ] 转待办后能生成新 `todo` 并出现在列表。

---

## 7. 时间与提醒策略

- [ ] 标准提醒：前一晚 20:00 + 事件前 1 小时。  
- [ ] 缺失时间地点兜底：当前时刻 -> 当日 23:59。  
- [ ] 兜底事件提醒：添加后 1 小时。  
- [ ] 明确不使用“当日整日”兜底。

---

## 8. 导入闭环

- [ ] `Import Calendar` 仅在有可处理项时可用。  
- [ ] 优先使用 Thunderbird Calendar API。  
- [ ] API 不可用时走 ICS 导出兜底。  
- [ ] 导入后源邮件标记已读。  
- [ ] 导入后事项进入完成态并从待处理列表移除。  
- [ ] 完成反馈包含导入数和标已读数。

---

## 9. 可观测性与稳定性

- [ ] 所有主按钮都有状态反馈。  
- [ ] 错误文案统一 `Action failed: reason`。  
- [ ] 错误信息不会被瞬时清空。  
- [ ] 无 `silent failure`（点击无反馈）。  
- [ ] 全局错误可被状态栏捕获并提示。

---

## 10. 回归测试最小集（每次发布前）

- [ ] 安装新 XPI 后可见新版本号。  
- [ ] 顶部入口、邮件入口均可打开。  
- [ ] LLM 保存可用。  
- [ ] 扫描可用、进度可见。  
- [ ] `important` 两键可用。  
- [ ] `todo` 编辑/确认/拒绝/恢复可用。  
- [ ] 导入可完成并标已读。  
- [ ] 无白屏、无按钮失效、无静默失败。

---

## 11. 2026-02-24 交互共识补充（冻结）

- [ ] 版本号不单独占用信息区；在窗口底部以一行小字展示。  
- [ ] 所有事件卡片都只显示标题、时间、地点三行；时间/地点缺失时隐藏该行。  
- [ ] “已接受事件”分组默认折叠、固定最后一组。  
- [ ] 其他分组默认展开。  
- [ ] 重复事件单击后可在卡片内联展开相关邮件列表。  
- [ ] 单击相关邮件项能跳转到对应邮件并显示全文。  

---
