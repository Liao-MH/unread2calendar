# Email2Calendar Thunderbird 插件 PRD + 设计详细版

日期：2026-02-24  
版本基线：`0.6.0`  
目标读者：产品经理、交互设计师、视觉设计师、前端/插件开发

---

## 1. 产品定义

### 1.1 产品愿景

把“邮件里潜在的行动项”快速转化为“可确认、可编辑、可导入日历的结构化待办”，降低用户漏看/忘记的重要事务。

### 1.2 产品定位

这是一个 Thunderbird 插件（XPI），不是独立邮箱客户端。  
插件在 Thunderbird 里提供 Todo 浮窗，承接“未读识别 -> 人工确认 -> 写入日历”的闭环。

### 1.3 核心价值

1. 节省用户人工从邮件中摘录事项的时间。  
2. 降低遗漏任务和错过提醒的风险。  
3. 在不强依赖云服务的情况下可用（本地规则兜底）。

---

## 2. 目标用户与场景

### 2.1 目标用户

1. 学生用户：课程通知、讲座、活动邮件多。  
2. 教职工/研究人员：会议/DDL/学术活动密集。  
3. 企业用户：跨部门通知多，关键信息分散在邮件中。

### 2.2 典型场景

1. 每天第一次打开邮箱，扫描未读并批量整理当天事项。  
2. 阅读某封邮件时，单击候选项跳转核对原文。  
3. 对“可能重要但未结构化”的邮件，手动转为待办。  
4. 完成确认后，一键导入日历并自动设置提醒。

---

## 3. 产品范围（Scope）

### 3.1 In Scope（本期）

1. Todo 浮窗（顶部按钮/邮件入口打开）。  
2. 未读邮件扫描与候选识别。  
3. 主题分组展示（含组内数量）。  
4. 单击跳转邮件、双击编辑。  
5. `important` 事项：标记已读、转为待办。  
6. 批量导入日历（TB Calendar API + ICS 兜底）。  
7. LLM 设置页（Base URL/Model/API Key）并本地保存。  
8. 未配置 LLM 时本地规则可独立运行。

### 3.2 Out of Scope（本期不做）

1. 完整邮件客户端能力替代（写信/复杂规则引擎）。  
2. 企业级多管理员后台。  
3. 跨设备实时同步（超出 Thunderbird 本地插件职责）。

---

## 4. 信息架构与页面结构

### 4.1 主浮窗结构

1. 顶栏：`Scan Unread`、`Refresh`、`LLM`。  
2. 扫描进度区：展示处理总量与百分比。  
3. LLM 提示区：未配置时提示去配置。  
4. 活动邮件信息区：当前邮件主题/发件人/时间。  
5. 主题分组区：各分组卡片列表。  
6. 底部状态区：操作结果/错误信息。  
7. 导入按钮：`Import Calendar`。

### 4.2 设置页结构

1. API Base URL  
2. Model  
3. API Key  
4. Save 按钮  
5. 保存状态反馈

---

## 5. 功能需求（详细）

## 5.1 扫描未读邮件

### 需求

1. 用户点击 `Scan Unread` 后触发未读扫描。  
2. 扫描期间显示进度。  
3. 扫描完成后刷新分组列表与状态文案。

### 交互细节

1. 点击后按钮应出现“执行中”反馈（禁用或状态文案）。  
2. 失败时给明确错误文本（不可静默）。  
3. 支持多账户（当前实现可走“扫描全部账户”稳定链路）。

## 5.2 候选抽取与分组

### 需求

1. 候选项至少包含：标题、时间、地点、摘要。  
2. 分组至少包含：
   - 学术讲座
   - 课程相关提示
   - 课外活动
   - 可能重要的事
   - 其他
3. 分组标题显示数量。

### 规则

1. 配置 LLM：优先用 LLM 抽取和分组。  
2. 未配置 LLM：仅本地规则抽取分组。  
3. 不应混合导致不可解释结果。

## 5.3 事项卡片交互

### 单击

1. 选中事项。  
2. 跳转对应邮件。  
3. 邮件列表/正文区体现当前上下文。

### 双击

1. 进入编辑态（`todo` 项）。  
2. 支持修改标题/时间/地点/备注并保存。

### `important` 项快捷操作

1. `标记已读`：对应邮件标记已读，事项进入已处理状态。  
2. `转为待办`：弹出 3 输入框（标题、时间、地点）。

### 转待办兜底规则

1. 若用户未补齐时间地点，允许兜底。  
2. 时间段：当前时刻 -> 当日 23:59。  
3. 提醒：添加后 1 小时。

## 5.4 日历导入

### 需求

1. 待导入项可批量写入日历。  
2. 导入成功后：
   - 事项移出待处理
   - 源邮件标记已读
3. 提供外部日历路径（ICS）。

### 提醒策略

1. 标准事项：前一晚 20:00 + 事件前 1 小时。  
2. 兜底事项：添加后 1 小时。

---

## 6. 关键用户旅程（UX Flow）

### 旅程 A：首次使用

1. 用户安装插件 -> 打开 Todo 浮窗。  
2. 看到“建议配置 LLM（可选）”。  
3. 点击 `LLM` -> 打开设置页 -> 保存配置。  
4. 返回浮窗点击 `Scan Unread` 开始识别。

### 旅程 B：日常清理未读

1. 点击扫描。  
2. 进入主题分组列表。  
3. 单击核对原邮件；双击修正信息。  
4. 对不需要项拒绝；对需要项确认。  
5. 统一导入日历。

### 旅程 C：重要但不完整的邮件

1. 邮件进入“可能重要的事”。  
2. 用户选择：
   - 标记已读（仅清理）
   - 转为待办（补录结构化信息）
3. 转待办后进入常规导入流程。

---

## 7. 交互规范（可交付设计）

### 7.1 组件规范

1. 顶栏按钮：主操作（Scan）+ 次操作（Refresh/LLM）。  
2. 分组容器：组标题 + 计数 + 列表。  
3. 事项卡片：
   - 标题（可含重复标记）
   - 时间
   - 地点
   - 摘要
   - 操作按钮
4. 状态栏：始终可见，显示最后一次操作结果。

### 7.2 状态视觉

1. `pending`：正常显示。  
2. `queued`：可导入状态。  
3. `rejected`：灰化。  
4. `read_marked`：灰化。  
5. `done`：默认不在待处理列表显示。

### 7.3 反馈原则

1. 所有按钮点击必须有即时反馈。  
2. 异常信息可读，包含失败原因关键词。  
3. 不允许“点击后无任何变化”的静默失败。

---

## 8. 文案规范（产品/设计对齐）

### 8.1 行为文案

1. 扫描中：`Scanning unread...` / `正在扫描未读...`  
2. 保存成功：`Saved` / `已保存`  
3. 导入成功：`Imported X, marked read Y.`  
4. 失败提示：`<Action> failed: <reason>`

### 8.2 语义要求

1. 操作文案用动词开头。  
2. 错误文案必须带动作上下文（例如 Save failed、Scan failed）。  
3. 状态文案应简短、可重复出现。


---

## 9. 交互细节冻结清单（按已确认共识）

本节为“冻结版交互协议”，后续开发默认不得偏离。若需修改，必须先产品评审。

### 9.1 入口与窗口

1. 最终采用“浮窗侧栏”形态，不再强制注入 Thunderbird 邮件区第四栏。  
2. 顶部工具栏 `Todo Sidebar` 与邮件内 `Todo Sidebar` 都应打开同一能力窗口（同一功能集）。  
3. 不要求自动弹窗；由用户主动点击入口打开。  
4. 弹窗必须可反复打开关闭，不影响主邮件阅读流。

### 9.2 扫描入口与账户选择

1. 点击 `Scan Unread` 必须有即时反馈（状态文本或进度变化）。  
2. 原始目标是“先选账户再扫描”；若某平台控件不稳定，允许临时降级为“默认扫描全部账户”，但需在状态栏明确提示。  
3. 扫描进度的总数定义为“所选账户的总未读邮件数”。  
4. 扫描过程中需持续可见进度；结束后显示摘要（扫描数、抽取数）。

### 9.3 候选分组与呈现

1. 放弃“高置信/待确认”双轨展示，改为“按主题大组展示”。  
2. 组名可以由 LLM 动态生成，但 UI 结构保持一致。  
3. 每个组名右侧必须显示该组数量。  
4. 必须存在“可能重要的事”分组，用于承接“非明确待办但可能重要”的邮件。  
5. 若未配置 LLM，本地规则要重点关注“直接来自个人/非 no-reply 发件人”的邮件重要性。

### 9.4 卡片行为定义（单击/双击）

1. 单击卡片：
   - 选中该项
   - 跳转对应邮件
   - 邮件列表高亮对应邮件
   - 正文区显示对应邮件内容
   - 不进入编辑态
2. 双击卡片：
   - 进入编辑态（仅 `todo` 项）
   - 可编辑标题、时间、地点、备注
3. 交互优先级：单击永远是“定位核对”，双击才是“编辑修改”。

### 9.5 `important` 项处理

1. 每条 `important` 卡片必须提供两键：
   - `标记已读`
   - `转为待办`
2. 点击 `标记已读` 后：
   - 卡片进入灰化/已处理态
   - 源邮件标记已读
3. 点击 `转为待办` 后：
   - 卡片下方展开 3 输入框：标题、时间、地点
   - 用户确认后生成标准 `todo` 项
4. 若用户仍未补全时间/地点：
   - 时间区间自动设为“当前时刻 -> 当日 23:59”
   - 提醒策略改为“添加后 1 小时提醒”

### 9.6 `todo` 项处理

1. `todo` 卡片支持：
   - 确认（进入待导入）
   - 拒绝/删除（不导入）
   - 恢复（从拒绝回到待确认）
   - 编辑保存
2. 拒绝后应灰化，并可恢复。  
3. 重复提醒（同标题同时间）需可识别，标题应有重复标记（如 `[重复xN]`）。

### 9.7 导入与完成态

1. 不是逐条弹导入；而是用户确认完再统一导入。  
2. 导入目标：
   - 优先 Thunderbird 内置日历
   - 兜底 ICS 给外部日历（例如 Apple Calendar）
3. 导入后：
   - 已导入项不再显示在待处理列表
   - 对应邮件标记已读
   - 给出完成反馈（导入条数、标已读条数）
4. 导入前如所有待确认都处理完，应出现“下一步操作”提醒（引导导入）。

### 9.8 提醒策略（冻结）

1. 标准事项：前一晚 20:00 + 事件前 1 小时。  
2. 兜底事项（缺失时间地点）：添加后 1 小时提醒。  
3. 明确不使用“当日整日”作为兜底。

### 9.9 LLM 配置交互（冻结）

1. 安装后建议用户配置 LLM，但不强制。  
2. LLM 页面必须可保存且持久化（关闭再打开仍在）。  
3. 配置后识别逻辑应按“有 LLM -> 用 LLM；无 LLM -> 本地规则”。  
4. 配置失败或保存失败必须可见错误信息。

### 9.10 语言与主题

1. 文案应跟随 Thunderbird 语言（至少中英）。  
2. 颜色和视觉风格需与 Thunderbird 主题协调。  
3. 不可出现“按钮存在但点击静默无反馈”。

### 9.11 逐按钮交互表（冻结）

| 入口/按钮 | 触发条件 | 前置状态 | 核心动作 | 成功反馈 | 失败反馈 | 后置状态 |
|---|---|---|---|---|---|---|
| 顶部 `Todo Sidebar` | 用户点击工具栏按钮 | Thunderbird 已打开 | 打开 Todo 浮窗 | 浮窗出现并可操作 | 状态栏/日志可见错误 | 浮窗前台 |
| 邮件内 `Todo Sidebar` | 用户在邮件视图点击 | 有当前邮件上下文 | 打开同一 Todo 能力窗口 | 与顶部入口一致 | 同上 | 浮窗前台 |
| `Scan Unread` | 用户点击扫描 | 至少一个账户可读 | 扫描未读 + 抽取候选 | 进度推进 + 扫描摘要 | `Scan failed: reason` | 分组列表刷新 |
| `Refresh` | 用户点击刷新 | 任意 | 重新拉取当前上下文并重算候选 | 列表和当前邮件信息更新 | `Refresh failed: reason` | 状态同步 |
| `LLM` | 用户点击 | 任意 | 打开 LLM 设置页 | 设置页打开 | `Open settings failed: reason` | 可编辑配置 |
| 设置页 `Save` | 用户点击保存 | 字段可空 | 持久化 `BaseURL/Model/APIKey` | `Saved/已保存` | `Save failed: reason` | 下次打开可回填 |
| 事项卡片单击 | 用户单击卡片 | 卡片存在 | 选中 + 跳转源邮件 | 邮件高亮，正文显示对应邮件 | `Select failed: reason` | 仅选中，不编辑 |
| 事项卡片双击 | 用户双击 `todo` 卡片 | `kind=todo` | 进入编辑态 | 编辑区展开 | `Edit open failed` | 待编辑状态 |
| 卡片 `✓/确认` | 用户点击确认 | `todo + pending` | 进入待导入队列 | 状态变 `queued` | `Queue failed: reason` | 待导入 |
| 卡片 `✕/拒绝` | 用户点击拒绝 | `todo + pending/queued` | 标记拒绝并可恢复 | 卡片灰化 | `Reject failed: reason` | `rejected` |
| 卡片 `Undo/恢复` | 用户点击恢复 | `todo + rejected` | 回到待确认 | 卡片恢复正常样式 | `Restore failed` | `pending` |
| `important: 标记已读` | 用户点击 | `kind=important` | 对应邮件标已读 + 卡片已处理 | 卡片灰化/已处理 | `Mark read failed` | `read_marked` |
| `important: 转为待办` | 用户点击 | `kind=important` | 展开标题/时间/地点输入 | 转换表单展开 | `Open convert form failed` | 待提交 |
| `转换确认` | 用户点击确认 | 转换表单已展开 | 创建 `todo` 项；可走兜底时间 | `Converted to todo` | `Convert failed: reason` | 新 `todo` 出现在列表 |
| `Import Calendar` | 用户点击导入 | 存在 `queued/rejected` | 批量写日历 + 源邮件已读 | 导入结果统计 | `Import failed: reason` | 已处理项移出列表 |

### 9.12 状态机定义（冻结）

1. `todo`：`pending -> queued -> done`，或 `pending -> rejected -> pending`。  
2. `important`：`pending -> read_marked`，或 `pending -> converted (+new todo pending)`。  
3. 列表展示层面：`done` 默认不展示，`rejected/read_marked/converted` 可灰化或隐藏（由产品配置）。  
4. 任何状态迁移必须触发可见反馈（状态栏文本）。

### 9.13 异常处理交互约定（冻结）

1. 所有主操作按钮必须有 `loading/running` 反馈（文案或禁用态至少一种）。  
2. 失败文案格式统一：`<Action> failed: <reason>`。  
3. 错误信息在用户可读时间内可见，不自动瞬时消失。  
4. 若某交互控件在目标 Thunderbird 版本不兼容，应自动降级到更稳定路径（而不是无反馈）。


---

## 11. 设计验收标准（Design QA Checklist）

1. 顶栏三按钮在不同窗口尺寸下不换行错位。  
2. 分组标题与数量始终可见。  
3. 卡片信息层级：标题 > 时间/地点 > 摘要。  
4. 单击与双击行为不冲突。  
5. 重要事项操作按钮清晰区分。  
6. 编辑/转换表单字段可见、可输入、可提交。  
7. 扫描/导入/保存操作均有状态反馈。  
8. 失败提示可读，不被自动快速清空。  
9. 主题色与 Thunderbird 风格协调。  
10. 中英语言下布局不破版。

---

## 12. 产品验收标准（PRD QA Checklist）

1. 用户不配置 LLM 也能完成扫描与导入闭环。  
2. 用户配置 LLM 后设置可持久化。  
3. 扫描后可看到主题分组与数量。  
4. 重要事项支持标记已读、转为待办。  
5. 转待办在缺失时间地点时走兜底规则。  
6. 确认后可批量导入日历。  
7. 导入后邮件标记已读。  
8. 外部日历路径可通过 ICS 落地。  
9. 操作失败可见原因，便于用户反馈。  
10. 入口一致性（顶部/邮件入口）满足预期。


---

## 13. 异常与可观测性规范（产品/设计必须保留）

1. 任何主按钮点击都必须产生日志性反馈（状态栏文本）。  
2. 所有失败态都要包含动作名和原因关键词。  
3. 不允许自动过快清空错误信息（至少用户可复制）。  
4. 若某高级控件不兼容（如弹层选择器），应降级到可用路径而非静默失败。  
5. 版本号应在 UI 或插件信息可见，避免“用户误装旧包”。

---

## 14. 后续设计补充任务

1. 为“账户选择”提供稳定内嵌式 UI 组件（替代脆弱弹层）。  
2. 为“可能重要的事 -> 转待办”提供更明确的表单校验提示。  
3. 为导入前“下一步提醒”设计固定信息条（避免被忽略）。  
4. 给重复事项增加视觉聚合策略（展开/折叠）。

---

## 15. 结语

本文件作为“产品+设计详细基线”，用于统一后续评审与执行。  
开发应优先保证闭环可用与可观测，再逐步提升识别准确率和视觉精细度。

---

## 16. 2026-02-24 交互共识补充（冻结）

本节用于固化本轮头脑风暴结论。若与前文冲突，以本节为准。

### 16.1 信息呈现

1. 所有事件卡片统一只显示：标题、时间、地点三行。  
2. `notes/摘要` 不在默认态展示。  
3. 若事件缺失时间或地点，对应行不显示（不使用占位文案）。

### 16.2 分组策略

1. 常规分组由 LLM 归纳结果决定，组名允许变化。  
2. 若存在“可能重要的事”，该分组固定第一。  
3. “已接受事件”固定最后一组，默认折叠。  
4. 其他常规分组默认展开。

### 16.3 状态与列表行为

1. `todo` 确认接受后，事项从原分组移除并进入“已接受事件”。  
2. `todo` 拒绝后在原分组原位置灰显，不移动位置，并保留“恢复”。  
3. 恢复后仅更新状态，不改变原排序位置。

### 16.4 编辑触发

1. 只有双击 `todo` 卡片时才显示编辑输入框。  
2. 单击卡片仅用于选中、跳转邮件与核对，不触发编辑区显示。

### 16.5 重复事件交互

1. 重复事件标题必须有重复提示（如 `[重复xN]`）。  
2. 单击重复事件时，在卡片下方内联展开对应邮件列表。  
3. 单击列表邮件项时，必须跳转到对应邮件并显示全文。

### 16.6 版本号展示

1. 版本号不再单独占一块信息区。  
2. 版本号改为窗口底部一行小字显示。
